---
layout: post
title: "iOS网络处理封装模式一[原汁原味]"
description: ""
category: 'Network Process'
tags: ['Network Process']
---
{% include JB/setup %}

本篇我们主要是一起来看一下IOS编程中网络模块中最常见的2种方式，底层的TCP和上层的HTTP，只有先了解最原始的东西，我们才会了解它的不足，才能知道从何入手进行改造。

<!--more-->
我们都知道网络编程中iso的7层结构：  
![image]({{ site.attachment }}/posts/2015-02-01-networkprocessmode1_img1.png)   

>    
  > * 物理层，即物理传输介质层。   
  > * 数据链路层，即数据分发时的处理，包括MAC寻址、数据校验、流量控制等多种功能。  
  > * 网络层，也就是所说的IP层，就是IP封包，路由等。  
  > * 传输层，常见的TCP/UDP就位于此层，就是位于IP包上层的数据封包层。   
  > * 会话层，就是负责回话的建立。    
  > * 表示层，用于数据的压缩，转换，比如由于不同的CPU架构（eg : mips vs arm）导致会有高低位问题，我们常见的网络传输时与2端的大小端转换问题。  
  > * 应用层，就是最上层的协议了，eg:http,ftp,ssh......  

为了方便大家理解数据封装的层次关系，我们再来看一下下面这个图：      
![image]({{ site.attachment }}/posts/2015-02-01-networkprocessmode1_img2.png)    
在我们开发普通的移动互联网程序时，一般都很少涉及到底层的应用，大部分应用都是基于http这种最上层的应用进行数据的交换的。当然在其它开发领域就需要关注的比较多了，比如嵌入式开发。    
我们看3种主要应用场景： 

* 第一种当然是最常见的http了，大部分的app都使用http+json进行数据交换，我就不用废话了。    
* 很多涉及到效率、安全、跨平台或者嵌入第三方库时，如果再用http显然不太合适，这个时候我们就得使用TCP/UDP了。  
* 第三种情况在APP中很少见，就是涉及的比较底层了，比如修改mac地址，修改mac工作模式，带宽等很多底层的参数，大都的目地是为了数据包的抓取。    

一、TCP/UDP
由于ObjectiveC兼容C，所以我们当然可以使用C写TCP/UDP，这点并不是我们这篇的重点，我们还是来算cocoa sdk的做法吧。






